@model IEnumerable<Msit115BestOne.Areas.MyCaseCenter.Models.OrderViewModel>

@{
    ViewBag.Title = "ManCheck";
}

<h3 style="color: blue; text-align: center;">
    <strong><em style="font-size: 12px;"><span style="color: rgb(165, 42, 42);"><span style="font-size: 48px;"><cite><img alt="" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTtMvD4gj52GYO3egLJeduJ3GIaa49Q5I1ZtL_hHGYBkyItDtnT" style="width: 70px; height: 70px;" /></cite></span></span></em><em><span style="color:#a52a2a;"><span style="font-size:48px;"><cite><u>審核區&nbsp;<img alt="devil" height="20" src="http://www.i2yes.com/ckeditor/plugins/smiley/images/devil_smile.gif" title="devil" width="20" /></u></cite></span></span></em></strong>
</h3>
@section heads{
    <link href='http://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
    @*<link href="~/Areas/MyCaseCenter/css/bootstrap.css" rel="stylesheet" />*@
    <link href="~/Areas/MyCaseCenter/css/bootstrap-responsive.css" rel="stylesheet" />
    <link href="~/Areas/MyCaseCenter/css/prettyPhoto.css" rel="stylesheet" />
    <link href="~/Areas/MyCaseCenter/css/custom-styles.css" rel="stylesheet" />
    <!-- CSS================================================== -->
    <link rel="shortcut icon" href="~/Areas/MyCaseCenter/img/favicon.ico">
    <link rel="apple-touch-icon" href="~/Areas/MyCaseCenter/img/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="~/Areas/MyCaseCenter/img/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="~/Areas/MyCaseCenter/img/apple-touch-icon-114x114.png">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">

}
@section styles{
    <style>
        #sortable1, #sortable2 {
            border: 1px solid #eee;
            width: 142px;
            min-height: 20px;
            list-style-type: none;
            margin: 0;
            padding: 5px 0 0 0;
            float: left;
            margin-right: 10px;
        }

            #sortable1 li, #sortable2 li {
                margin: 0 5px 5px 5px;
                padding: 5px;
                font-size: 1.2em;
                width: 120px;
            }
    </style>
    <style>
         .img {
            width: 270px;
            height: 220px;
        }

        .modal {
            top: 10%; /* 向上的距離*/
            left: -3%;
            outline: none;
        }

        .vertical-alignment-helper {
            display: table;
            height: 100%;
            width: 100%;
        }

        .vertical-align-center {
            /* To center vertically */
            display: table-cell;
            vertical-align: middle;
        }

        .modal-content {
            /* Bootstrap sets the size of the modal in the modal-dialog class, we need to inherit it */
            width: inherit;
            height: inherit;
            /* To center horizontally */
            margin: 0 auto;
        }
    </style>
}
@foreach (var manpower in Model)
{
    <div class="modal fade" id="@manpower.MemberID" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="vertical-alignment-helper">
            <div class="modal-dialog vertical-align-center">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">
                            <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>

                        </button>
                        <h4 class="modal-title" id="myModalLabel">基本資料</h4>

                    </div>
                    <div class="modal-body">
                        <div class="img">
                            <a href="#"><img src="~/MyCaseCenter/MyManPower/BytesImagess/@manpower.MemberID" alt="Gallery" class="img"></a>
                        </div>
                        <ul class="project-info">
                            <li><h6>會員:</h6>@manpower.NickName</li>
                            <li><h6>生日:</h6>@manpower.Birthday</li>
                            <li><h6>連絡電話:</h6>@manpower.Phone</li>
                            <li><h6>專長:</h6>@manpower.MPSubClass1</li>
                            <li><h6>地址:</h6> @manpower.CityName @manpower.RegionName @manpower.Address</li>
                        </ul>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        @*<button type="button" class="btn btn-primary">Save changes</button>*@
                    </div>
                </div>
            </div>
        </div>
    </div>
}
<div class="color-bar-1"></div>
<div class="color-bar-2 color-bg"></div>
<div class="container main-container" >

    <!-- Page Content
    ================================================== -->
    <div class="row" >
        <div @*class="col-md-offset-2 col-md-6"*@>
            <div class="span7" >
                <br />
                @{
                    var cas = @ViewBag.CaseID;
                }
                @Html.HiddenFor(e => cas)
                <h6 class="title-bg"><a href="~/MyCaseCenter/MyManPower/LoadMan/@ViewBag.CaseID" style="color:blue;font-size:20px;"><span class="glyphicon glyphicon-queen"> </span>@ViewBag.CaseTitle</a></h6>
            </div>
        </div>
        @*<div class="col-md-offset-3 col-md-12">
                    <a href="~/MyCaseCenter/MyManPower/LoadMan/@ViewBag.CaseID" style="color:blue;font-size:20px;"><span class="glyphicon glyphicon-queen"> </span>@ViewBag.CaseTitle</a><br />
            </div>*@

        <div class="col-md-3"></div>
        <div class="col-md-offset-3 col-md-6 panel panel-info" style="height:auto;margin-top:10px;margin-left:50px">
            <div class="row">
                <div class="col-md-6">
                    <h3 class="title-bg" id="Conut">應徵人數: @ViewBag.MPActuralCount</h3>

                    <ul id="sortable1" class="connectedSortable" style="margin-top:10px;margin-right:10px;margin-bottom:10px;margin-left:50px;">
                        @foreach (var manpower in Model)
                        {
                            <li class="ui-state-highlight" id="@manpower.MemberID" data-toggle="modal" data-target="#@manpower.MemberID">@manpower.NickName</li>
                            @*<li class="ui-state-highlight" id="@manpower.MemberID"><a href="#"><img src="~/Images/01-recentpost.jpg" /></a>@manpower.NickName</li>*@

                        }

                        @*<li class="ui-state-default">Item 2</li>
                            <li class="ui-state-default">Item 3</li>
                            <li class="ui-state-default">Item 4</li>*@
                    </ul>
                </div>
                <div class="col-md-6">
                    @{
                        var mp = @ViewBag.MPNeedCount;
                        var st= @ViewBag.StatusID;
                    }
                    <h3 class="title-bg" id="NeedConut">需求人數: @ViewBag.MPNeedCount</h3>
                    @Html.HiddenFor(e => mp)
                    @Html.HiddenFor(e => st)
                    <ul id="sortable2" class="connectedSortable" style="margin-top:10px;margin-right:10px;margin-bottom:10px;margin-left:50px;">
                        @*<li class="ui-state-highlight">Item 1</li>
                            <li class="ui-state-highlight">Item 2</li>
                            <li class="ui-state-highlight">Item 3</li>
                            <li class="ui-state-highlight">Item 4</li>
                            <li class="ui-state-highlight">Item 5</li>*@
                    </ul><br />
                    <button id="btncheck" class="btn btn-info">確定</button>
                </div>
            </div>
            
        </div>
        
    </div><a href="~/MyCaseCenter/MyManPower/LoadMan" class="btn btn-warning" style="margin-left:700px;"><i class="icon-arrow-left"></i>上一頁</a><h4></h4>
</div>

@section scripts{
    <script src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
    <script src="~/Areas/MyCaseCenter/js/jquery.easing.1.3.js"></script>
    <script src="~/Areas/MyCaseCenter/js/bootstrap.js"></script>
    <script src="~/Areas/MyCaseCenter/js/jquery.prettyPhoto.js"></script>
    <script src="~/Areas/MyCaseCenter/js/jquery.quicksand.js"></script>
    <script src="~/Areas/MyCaseCenter/js/jquery.custom.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
        $(function () {
            $("#sortable1, #sortable2").sortable({
                connectWith: ".connectedSortable"
            }).disableSelection();

            //alert($("#sortable1>li").length);      //li的數量
            //alert($("#sortable1>li").attr('id'));    //li的id

            //$('#sortable1 li').each(function () {
            //    $(this).click(
            //		function () {
            //		    alert($(this).attr('id'));
            //		});
            //});


            var u = $("#sortable2");
            var need = $('#mp').val();  //需求人數
            var st = $('#st').val();//Case 狀態
            $('#sortable2').hover(function () {
                if (need < $("#sortable2>li").length)
                { u.css('background-color', 'red'); $('h4').text("超過囉!!").css('color', 'red'); }
                else
                { u.css('background-color', 'white'); $('h4').text("") }
            }, function () {
                if (need < $("#sortable2>li").length)
                { u.css('background-color', 'red'); $('h4').text("超過囉!!").css('color', 'red'); }
                else
                { u.css('background-color', 'white'); $('h4').text("") }
            });

            $('#sortable1').hover(function () {
                if (need < $("#sortable2>li").length)
                { u.css('background-color', 'red'); $('h4').text("超過囉!!").css('color', 'red'); }
                else
                { u.css('background-color', 'white'); $('h4').text("") }
            }, function () {
                if (need < $("#sortable2>li").length)
                { u.css('background-color', 'red'); $('h4').text("超過囉!!").css('color', 'red'); }
                else
                { u.css('background-color', 'white'); $('h4').text("") }
            });
            if (st == 8) {
                $('#NeedConut').text('提供人數: ' + need);
            }


            var check = $('#btncheck');
            var cas = $('#cas').val();  //CaseID
            check.click(function () {

                var items = [];  // 右邊全部的<li>的id  MemberID
                $('#sortable2 li').each(function () {
                    items.push($(this).attr('id'));
                });
                //alert(items);

                var url = "@Url.Action("CheckRight","MyManPower")";
                //$.getJSON(url, {id:cas,item:items}, function (datas) {
                ////$.getJSON(url, {id:'23',item:'45'}, function (datas) {
                //    alert('456');
                //    $.each(datas, function (idx, ord) {
                //        opt = ord.NickName;
                //        alert('789');
                //    })


                //})
                alert('已送出審核');
                $.ajax({
                    url: url,
                    data: {
                        id: cas,
                        Area: items
                    },
                    type: "POST",
                    dataType: "json",
                    traditional: true,
                    crossDomain: true,
                    async: false,
                    success: function (doc) {
                        //var doo = $(doc).find('Member');
                        //doc.each(function () {
                        //    //var nickname = $(this).children('NickName').text();
                        //    var nickname = $(this).NickName
                        //    alert(nickname);
                           
                        //})
                        window.location.href = doc;
                    },
                    error: function (xhr) {
                        //window.location.href = xhr;
                    }
                })
                //    .done(function (doc) {
                //    var doo = $(doc).find('Member');
                //    doo.each(function () {
                //        var nickname = $(this).children('NickName').text();

                //        alert(nickname);
                //    })
                //});
               

            })


        });
    </script>

}
